<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.telei.wms.datasource.wms.repository.WmsInventoryRepository">
    <sql id="Custom_Base_Column_List">
        cp.product_no,
        cp.product_name,
        cp.product_barcode,
        (wi.big_bag_rate / wi.mid_bag_rate) as big_bag_rate ,
        wi.mid_bag_rate,
        (wi.big_bag_rate * wi.mid_bag_rate) as box_qty,
        cp.big_bag_vol,
        cp.big_bag_weight,
        wi.lc_code,
        wl.lc_type,
        wi.iv_qty as qty,
        cp.cost_reference,
        (wi.iv_qty * cp.cost_reference) as inventoryAmount
    </sql>

    <select id="doIvSnapshotSchedule" statementType="CALLABLE">
		{call copy_wms_inventory_into_snapshot(#{idNumber},#{serverNo},#{snapshotTime},#{snapshotLcTime})}
	</select >

    <select id="selectByLcCodeAndProductId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from wms_inventory
        where  lc_code=#{lcCode}
        and product_id=#{productId}
        order by iab_Id
    </select>



    <select id="selectCustomPage" resultType="com.telei.wms.datasource.wms.vo.WmsInventoryPageQueryResponseVo">
        select
        <include refid="Custom_Base_Column_List"></include>
        from wms_inventory wi
        left join cdm.cdm_product cp on wi.product_id = cp.product_id
        left join wms_location wl on wi.lc_code = wl.lc_code
        <where>
            <if test="lcCode != null">
                and wi.lc_code ${lcCode}
            </if>
            <if test="productNo != null">
                and cp.product_no ${productNo}
            </if>
            <if test="productName != null">
                and cp.product_name ${productName}
            </if>
            <if test="productBarcode != null">
                and cp.product_barcode ${productBarcode}
            </if>
            <if test="lcType != null">
                and wl.lc_type ${lcType}
            </if>
        </where>
        <if test="orderBy != null">
            order by ${orderBy}
        </if>
    </select>
</mapper>

